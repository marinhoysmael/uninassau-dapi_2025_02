
# Resumo da Aula 28/08/2025 – HTML, CSS e JavaScript (Calculadora)

> **Foco:** explicar principalmente as **funções JavaScript**, linha a linha, mostrando como o DOM é manipulado e como a lógica da calculadora funciona. Incluo também um resumo breve de HTML e CSS para dar contexto.

---

## 📁 Arquivos do projeto
- `index.html` — estrutura da página (display e botões).
- `index.css` — estilos (layout, cores e feedback visual).
- `index.js` — lógica e interatividade (DOM, eventos e funções).

---

## 🧱 HTML — visão geral rápida
Pontos principais do `index.html`:

```html
<link rel="stylesheet" href="./index.css">
```
Carrega o CSS com os estilos usados na calculadora.

```html
<div class="display">
  <span class="operation" id="operation">-</span>
</div>
```
Área do **display** onde o JavaScript escreve a expressão e o resultado. O `id="operation"` será usado no JS.

```html
<div class="button value" onclick="calcular('7')">7</div>
<div class="button action" onclick="calcular('+')">+</div>
<div class="button value" id="equal" onclick="gerarResultado()">=</div>
<div class="button action" id="buttonAc" onclick="limparConta('CE')">CE</div>
```
Cada botão dispara uma função do JS via `onclick(...)`.

```html
<script src="./index.js"></script>
```
Carrega a lógica JavaScript **depois** do HTML, garantindo que os elementos existam quando o JS rodar.

---

## 🎨 CSS — visão geral rápida
Pontos principais do `index.css`:

- **Layout com Flexbox** para o container e linhas de botões:
  ```css
  #calculadora { display: flex; flex-direction: column; }
  .row { display: flex; justify-content: space-around; }
  ```
- **Display** com borda, tipografia e alinhamento à direita:
  ```css
  .display { border: 1px solid #6a6c72; font-size: 30px; align-items: flex-end; }
  .display .operation { margin-right: 20px; }
  ```
- **Botões** com aparência circular, hover e variações por tipo:
  ```css
  .button { border-radius: 37px; cursor: pointer; }
  .button:hover { background-color: #90939e; }
  .action { background-color: #2c303d; color: #fff; }
  .value  { background-color: #1f1f1f; color: #fff; }
  #equal  { background-color: #a8c7fa; color: #1f1f1f; }
  ```

---

## ⚡ JavaScript — explicação **linha a linha** das funções e lógica

### 0) Variáveis globais e acesso ao DOM
```js
console.log("Hello World JS");
let calculo = "";
let ultimoComando = "";
let displayOperation = document.getElementById("operation");
```
- `console.log("Hello World JS");` imprime uma mensagem no console — útil para verificar se o script carregou.
- `let calculo = "";` guarda a **expressão atual** digitada (ex.: `"7+8*2"`).
- `let ultimoComando = "";` guarda o **último caractere** inserido (para evitar operadores duplicados, por exemplo `"++"`).
- `let displayOperation = document.getElementById("operation");` pega a referência ao elemento do display para **escrever o texto**.

```js
displayOperation.textContent = "0";
```
- Define o estado inicial do display como `"0"`.

---

### 1) Captura de **eventos de teclado** (digitação)
```js
document.addEventListener("keypress", function(evento){
  console.log(evento.key);
  
  if(
    evento.key == '1' || evento.key == '2' || evento.key == '3' ||
    evento.key == '4' || evento.key == '5' || evento.key == '6' ||
    evento.key == '7' || evento.key == '8' || evento.key == '9' ||
    evento.key == '0' || evento.key == '*' || evento.key == '/' ||
    evento.key == '+' || evento.key == '-' || evento.key == '.' ||
    evento.key == '(' || evento.key == ')'
  ){
    return calcular(evento.key);
  }

  if(evento.key == 'Enter'){
    gerarResultado();
  }
});
```
- `document.addEventListener("keypress", ...)` escuta **todas as teclas pressionadas** na página.
- `console.log(evento.key);` exibe no console **qual tecla** foi digitada (debug).
- O `if (...) { return calcular(evento.key); }` verifica se a tecla é **válida** para a calculadora (números, operadores, parênteses e ponto). Se for, chama `calcular` com o caracter digitado e **retorna** (para não verificar o próximo `if`).
- O segundo `if` trata o caso específico da tecla **Enter**, chamando `gerarResultado()`.

> **Sugestão de melhoria:** usar uma estrutura mais limpa para validação, por exemplo um conjunto:
> ```js
> const validas = new Set("0123456789+-*/().".split(""));
> if (validas.has(evento.key)) { calcular(evento.key); }
> ```

---

### 2) Função **calcular(value)** — acumula e mostra a expressão
```js
function calcular(value){
  if(
    value == ultimoComando &&
    (ultimoComando == '+' || ultimoComando == '-' || ultimoComando == '*' || ultimoComando == '/')
  ){
    return;
  }
  ultimoComando = value;

  calculo += value;

  console.log("calcular: " + calculo);

  displayOperation.textContent = calculo.replaceAll('*','x');
}
```
**Linha a linha:**
- `function calcular(value){` define a função que recebe o **caractere** clicado/digitado.
- O primeiro `if (...) return;` impede **operadores duplicados** consecutivos do mesmo tipo, como `"++"` ou `"**"`. Se o novo `value` for igual ao `ultimoComando` **e** for um operador `+ - * /`, a função interrompe.
- `ultimoComando = value;` atualiza o **último comando** para a próxima validação.
- `calculo += value;` **concatena** o `value` ao final da string `calculo` (ex.: `"" + "7"` vira `"7"`, depois `"7" + "+"` vira `"7+"`).
- `console.log("calcular: " + calculo);` loga a expressão atual (debug).
- `displayOperation.textContent = calculo.replaceAll('*','x');` **mostra** a expressão no display, trocando o `*` por `x` apenas por estética — o valor real em `calculo` **continua** com `*` (necessário para o cálculo).

> **Observação:** esse `if` bloqueia operadores **duplicados idênticos**, mas ainda permite algo como `"+-"`. Se quiser bloquear **qualquer sequência** de dois operadores, é possível validar o último caractere antes de inserir um novo.

---

### 3) Função **limparConta()** — limpa expressão e reseta o display
```js
function limparConta(){
  console.log("Limpar Conta: " + calculo);
  calculo = "";
  displayOperation.textContent = "0";

  document.getElementById("buttonAc").textContent = "CE";
}
```
**Linha a linha:**
- Loga no console a expressão que está sendo descartada.
- Zera a string `calculo`.
- Volta o display para `"0"`.
- Atualiza o texto do botão de limpar (`#buttonAc`) para `"CE"` (Clear Entry). A interface diferencia **CE** (limpa a entrada) e **AC** (All Clear) usando este texto como feedback visual.

> **Sugestão:** implementar um **modo CE** (apagar último caractere) e um **modo AC** (apagar tudo). Hoje, a função limpa tudo; você pode evoluir para que o primeiro clique apague só a última entrada, e o segundo clique (ou um estado alternado) apague tudo.

---

### 4) Função **gerarResultado()** — avalia a expressão e mostra o resultado
```js
function gerarResultado(){
  if(calculo != ""){
    console.log("Rerar Resultado: " + calculo);

    let resultado = "" + eval(calculo);
    displayOperation.textContent = resultado.replaceAll('*','x');
    console.log("O resultado da conta " + calculo + " e: " + resultado);
    calculo = resultado;

    document.getElementById("buttonAc").textContent = "AC";
  }
}
```
**Linha a linha:**
- `if (calculo != "") {` evita calcular quando não há nada digitado.
- `let resultado = "" + eval(calculo);` calcula a **expressão** em `calculo` usando `eval`. O `"" +` converte o resultado para **string**.
- `displayOperation.textContent = resultado.replaceAll('*','x');` atualiza o display com o resultado. (A substituição aqui não é necessária caso o resultado não contenha `*`; mantém apenas a consistência visual.)
- `console.log(...)` exibe no console a operação e o resultado.
- `calculo = resultado;` permite continuar **encadeando operações** (ex.: depois de `7+8=15`, se apertar `*2`, a nova expressão vira `"15*2"`).
- Atualiza o botão de limpar para `"AC"` para sinalizar que a calculadora está com um **resultado completo**.

> ⚠️ **Atenção sobre `eval`:** `eval` executa **qualquer código** contido na string. Em apps reais, isso pode ser **perigoso** se vier input do usuário sem validação. Para uma calculadora simples, duas alternativas mais seguras são:
> - Validar a expressão com uma **whitelist** de caracteres permitidos (`0-9`, operadores e parênteses) e usar `Function("return " + expr)()` em um `try/catch`.
> - Implementar (ou usar) um **parser** de expressões matemáticas (sem `eval`).

Exemplo de validação simples antes do `eval`:
```js
const permitido = /^[0-9+\-*/().\s%]+$/;
if (!permitido.test(calculo)) {
  alert("Expressão inválida.");
  return;
}
```

> **Melhoria adicional:** tratar erros com `try { ... } catch(e) { ... }` para evitar que uma expressão inválida quebre a aplicação:
> ```js
> try {
>   let resultado = "" + eval(calculo);
>   // ... resto do código
> } catch (e) {
>   displayOperation.textContent = "Erro";
> }
> ```

---

### 5) Função **eventoDoTeclado(event)** — utilitário para debug
```js
function eventoDoTeclado(event){
  console.log(event);
}
```
- Função não utilizada no fluxo principal. Útil para **inspecionar** o objeto do evento durante o desenvolvimento.

---

## 🧠 Boas práticas e melhorias sugeridas
- **Acessibilidade:** use `<button>` no HTML em vez de `<div class="button">`, permitindo foco via teclado, `aria-pressed`, etc. Ou adicione `role="button"` e `tabindex="0"`.
- **Delegação de eventos:** em vez de `onclick` direto no HTML, adicione um **único** listener no container e detecte o botão clicado com `event.target` (melhora manutenção).
- **Backspace:** suporte à tecla **Backspace** para apagar o último caractere.
- **Operadores duplicados / sequência inválida:** bloqueie duas entradas de operadores seguidas (não apenas duplicadas iguais).
- **Parênteses e ponto:** valide balanço de parênteses e 1 ponto por número.
- **Estado CE/AC real:** primeiro clique em **CE** apaga a última entrada; depois de um `=`, mostrar **AC** para limpar tudo.
- **Modo estrito:** prefira `===` a `==` nas comparações.
- **Estrutura:** isole a lógica em um módulo (IIFE ou classe) para evitar variáveis globais.

---

## ✅ O que você aprendeu
- **DOM:** buscar elementos (`getElementById`), atualizar texto (`textContent`), ouvir eventos (`addEventListener`).
- **Manipulação de texto:** construir expressões com strings e formatar saída (`replaceAll`).
- **Eventos:** responder a **cliques** e **teclas**.
- **Funções:** `calcular`, `limparConta` e `gerarResultado` compõem o fluxo principal da calculadora.

---

### Desafio opcional para a turma
Implemente **Backspace** (tecla e botão): se houver algo em `calculo`, remova o **último caractere** e atualize o display. Trate o caso em que só sobra vazio e volte para `"0"`.