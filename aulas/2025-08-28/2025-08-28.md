
# Resumo da Aula 28/08/2025 ‚Äì HTML, CSS e JavaScript (Calculadora)

> **Foco:** explicar principalmente as **fun√ß√µes JavaScript**, linha a linha, mostrando como o DOM √© manipulado e como a l√≥gica da calculadora funciona. Incluo tamb√©m um resumo breve de HTML e CSS para dar contexto.

---

## üìÅ Arquivos do projeto
- `index.html` ‚Äî estrutura da p√°gina (display e bot√µes).
- `index.css` ‚Äî estilos (layout, cores e feedback visual).
- `index.js` ‚Äî l√≥gica e interatividade (DOM, eventos e fun√ß√µes).

---

## üß± HTML ‚Äî vis√£o geral r√°pida
Pontos principais do `index.html`:

```html
<link rel="stylesheet" href="./index.css">
```
Carrega o CSS com os estilos usados na calculadora.

```html
<div class="display">
  <span class="operation" id="operation">-</span>
</div>
```
√Årea do **display** onde o JavaScript escreve a express√£o e o resultado. O `id="operation"` ser√° usado no JS.

```html
<div class="button value" onclick="calcular('7')">7</div>
<div class="button action" onclick="calcular('+')">+</div>
<div class="button value" id="equal" onclick="gerarResultado()">=</div>
<div class="button action" id="buttonAc" onclick="limparConta('CE')">CE</div>
```
Cada bot√£o dispara uma fun√ß√£o do JS via `onclick(...)`.

```html
<script src="./index.js"></script>
```
Carrega a l√≥gica JavaScript **depois** do HTML, garantindo que os elementos existam quando o JS rodar.

---

## üé® CSS ‚Äî vis√£o geral r√°pida
Pontos principais do `index.css`:

- **Layout com Flexbox** para o container e linhas de bot√µes:
  ```css
  #calculadora { display: flex; flex-direction: column; }
  .row { display: flex; justify-content: space-around; }
  ```
- **Display** com borda, tipografia e alinhamento √† direita:
  ```css
  .display { border: 1px solid #6a6c72; font-size: 30px; align-items: flex-end; }
  .display .operation { margin-right: 20px; }
  ```
- **Bot√µes** com apar√™ncia circular, hover e varia√ß√µes por tipo:
  ```css
  .button { border-radius: 37px; cursor: pointer; }
  .button:hover { background-color: #90939e; }
  .action { background-color: #2c303d; color: #fff; }
  .value  { background-color: #1f1f1f; color: #fff; }
  #equal  { background-color: #a8c7fa; color: #1f1f1f; }
  ```

---

## ‚ö° JavaScript ‚Äî explica√ß√£o **linha a linha** das fun√ß√µes e l√≥gica

### 0) Vari√°veis globais e acesso ao DOM
```js
console.log("Hello World JS");
let calculo = "";
let ultimoComando = "";
let displayOperation = document.getElementById("operation");
```
- `console.log("Hello World JS");` imprime uma mensagem no console ‚Äî √∫til para verificar se o script carregou.
- `let calculo = "";` guarda a **express√£o atual** digitada (ex.: `"7+8*2"`).
- `let ultimoComando = "";` guarda o **√∫ltimo caractere** inserido (para evitar operadores duplicados, por exemplo `"++"`).
- `let displayOperation = document.getElementById("operation");` pega a refer√™ncia ao elemento do display para **escrever o texto**.

```js
displayOperation.textContent = "0";
```
- Define o estado inicial do display como `"0"`.

---

### 1) Captura de **eventos de teclado** (digita√ß√£o)
```js
document.addEventListener("keypress", function(evento){
  console.log(evento.key);
  
  if(
    evento.key == '1' || evento.key == '2' || evento.key == '3' ||
    evento.key == '4' || evento.key == '5' || evento.key == '6' ||
    evento.key == '7' || evento.key == '8' || evento.key == '9' ||
    evento.key == '0' || evento.key == '*' || evento.key == '/' ||
    evento.key == '+' || evento.key == '-' || evento.key == '.' ||
    evento.key == '(' || evento.key == ')'
  ){
    return calcular(evento.key);
  }

  if(evento.key == 'Enter'){
    gerarResultado();
  }
});
```
- `document.addEventListener("keypress", ...)` escuta **todas as teclas pressionadas** na p√°gina.
- `console.log(evento.key);` exibe no console **qual tecla** foi digitada (debug).
- O `if (...) { return calcular(evento.key); }` verifica se a tecla √© **v√°lida** para a calculadora (n√∫meros, operadores, par√™nteses e ponto). Se for, chama `calcular` com o caracter digitado e **retorna** (para n√£o verificar o pr√≥ximo `if`).
- O segundo `if` trata o caso espec√≠fico da tecla **Enter**, chamando `gerarResultado()`.

> **Sugest√£o de melhoria:** usar uma estrutura mais limpa para valida√ß√£o, por exemplo um conjunto:
> ```js
> const validas = new Set("0123456789+-*/().".split(""));
> if (validas.has(evento.key)) { calcular(evento.key); }
> ```

---

### 2) Fun√ß√£o **calcular(value)** ‚Äî acumula e mostra a express√£o
```js
function calcular(value){
  if(
    value == ultimoComando &&
    (ultimoComando == '+' || ultimoComando == '-' || ultimoComando == '*' || ultimoComando == '/')
  ){
    return;
  }
  ultimoComando = value;

  calculo += value;

  console.log("calcular: " + calculo);

  displayOperation.textContent = calculo.replaceAll('*','x');
}
```
**Linha a linha:**
- `function calcular(value){` define a fun√ß√£o que recebe o **caractere** clicado/digitado.
- O primeiro `if (...) return;` impede **operadores duplicados** consecutivos do mesmo tipo, como `"++"` ou `"**"`. Se o novo `value` for igual ao `ultimoComando` **e** for um operador `+ - * /`, a fun√ß√£o interrompe.
- `ultimoComando = value;` atualiza o **√∫ltimo comando** para a pr√≥xima valida√ß√£o.
- `calculo += value;` **concatena** o `value` ao final da string `calculo` (ex.: `"" + "7"` vira `"7"`, depois `"7" + "+"` vira `"7+"`).
- `console.log("calcular: " + calculo);` loga a express√£o atual (debug).
- `displayOperation.textContent = calculo.replaceAll('*','x');` **mostra** a express√£o no display, trocando o `*` por `x` apenas por est√©tica ‚Äî o valor real em `calculo` **continua** com `*` (necess√°rio para o c√°lculo).

> **Observa√ß√£o:** esse `if` bloqueia operadores **duplicados id√™nticos**, mas ainda permite algo como `"+-"`. Se quiser bloquear **qualquer sequ√™ncia** de dois operadores, √© poss√≠vel validar o √∫ltimo caractere antes de inserir um novo.

---

### 3) Fun√ß√£o **limparConta()** ‚Äî limpa express√£o e reseta o display
```js
function limparConta(){
  console.log("Limpar Conta: " + calculo);
  calculo = "";
  displayOperation.textContent = "0";

  document.getElementById("buttonAc").textContent = "CE";
}
```
**Linha a linha:**
- Loga no console a express√£o que est√° sendo descartada.
- Zera a string `calculo`.
- Volta o display para `"0"`.
- Atualiza o texto do bot√£o de limpar (`#buttonAc`) para `"CE"` (Clear Entry). A interface diferencia **CE** (limpa a entrada) e **AC** (All Clear) usando este texto como feedback visual.

> **Sugest√£o:** implementar um **modo CE** (apagar √∫ltimo caractere) e um **modo AC** (apagar tudo). Hoje, a fun√ß√£o limpa tudo; voc√™ pode evoluir para que o primeiro clique apague s√≥ a √∫ltima entrada, e o segundo clique (ou um estado alternado) apague tudo.

---

### 4) Fun√ß√£o **gerarResultado()** ‚Äî avalia a express√£o e mostra o resultado
```js
function gerarResultado(){
  if(calculo != ""){
    console.log("Rerar Resultado: " + calculo);

    let resultado = "" + eval(calculo);
    displayOperation.textContent = resultado.replaceAll('*','x');
    console.log("O resultado da conta " + calculo + " e: " + resultado);
    calculo = resultado;

    document.getElementById("buttonAc").textContent = "AC";
  }
}
```
**Linha a linha:**
- `if (calculo != "") {` evita calcular quando n√£o h√° nada digitado.
- `let resultado = "" + eval(calculo);` calcula a **express√£o** em `calculo` usando `eval`. O `"" +` converte o resultado para **string**.
- `displayOperation.textContent = resultado.replaceAll('*','x');` atualiza o display com o resultado. (A substitui√ß√£o aqui n√£o √© necess√°ria caso o resultado n√£o contenha `*`; mant√©m apenas a consist√™ncia visual.)
- `console.log(...)` exibe no console a opera√ß√£o e o resultado.
- `calculo = resultado;` permite continuar **encadeando opera√ß√µes** (ex.: depois de `7+8=15`, se apertar `*2`, a nova express√£o vira `"15*2"`).
- Atualiza o bot√£o de limpar para `"AC"` para sinalizar que a calculadora est√° com um **resultado completo**.

> ‚ö†Ô∏è **Aten√ß√£o sobre `eval`:** `eval` executa **qualquer c√≥digo** contido na string. Em apps reais, isso pode ser **perigoso** se vier input do usu√°rio sem valida√ß√£o. Para uma calculadora simples, duas alternativas mais seguras s√£o:
> - Validar a express√£o com uma **whitelist** de caracteres permitidos (`0-9`, operadores e par√™nteses) e usar `Function("return " + expr)()` em um `try/catch`.
> - Implementar (ou usar) um **parser** de express√µes matem√°ticas (sem `eval`).

Exemplo de valida√ß√£o simples antes do `eval`:
```js
const permitido = /^[0-9+\-*/().\s%]+$/;
if (!permitido.test(calculo)) {
  alert("Express√£o inv√°lida.");
  return;
}
```

> **Melhoria adicional:** tratar erros com `try { ... } catch(e) { ... }` para evitar que uma express√£o inv√°lida quebre a aplica√ß√£o:
> ```js
> try {
>   let resultado = "" + eval(calculo);
>   // ... resto do c√≥digo
> } catch (e) {
>   displayOperation.textContent = "Erro";
> }
> ```

---

### 5) Fun√ß√£o **eventoDoTeclado(event)** ‚Äî utilit√°rio para debug
```js
function eventoDoTeclado(event){
  console.log(event);
}
```
- Fun√ß√£o n√£o utilizada no fluxo principal. √ötil para **inspecionar** o objeto do evento durante o desenvolvimento.

---

## üß† Boas pr√°ticas e melhorias sugeridas
- **Acessibilidade:** use `<button>` no HTML em vez de `<div class="button">`, permitindo foco via teclado, `aria-pressed`, etc. Ou adicione `role="button"` e `tabindex="0"`.
- **Delega√ß√£o de eventos:** em vez de `onclick` direto no HTML, adicione um **√∫nico** listener no container e detecte o bot√£o clicado com `event.target` (melhora manuten√ß√£o).
- **Backspace:** suporte √† tecla **Backspace** para apagar o √∫ltimo caractere.
- **Operadores duplicados / sequ√™ncia inv√°lida:** bloqueie duas entradas de operadores seguidas (n√£o apenas duplicadas iguais).
- **Par√™nteses e ponto:** valide balan√ßo de par√™nteses e 1 ponto por n√∫mero.
- **Estado CE/AC real:** primeiro clique em **CE** apaga a √∫ltima entrada; depois de um `=`, mostrar **AC** para limpar tudo.
- **Modo estrito:** prefira `===` a `==` nas compara√ß√µes.
- **Estrutura:** isole a l√≥gica em um m√≥dulo (IIFE ou classe) para evitar vari√°veis globais.

---

## ‚úÖ O que voc√™ aprendeu
- **DOM:** buscar elementos (`getElementById`), atualizar texto (`textContent`), ouvir eventos (`addEventListener`).
- **Manipula√ß√£o de texto:** construir express√µes com strings e formatar sa√≠da (`replaceAll`).
- **Eventos:** responder a **cliques** e **teclas**.
- **Fun√ß√µes:** `calcular`, `limparConta` e `gerarResultado` comp√µem o fluxo principal da calculadora.

---

### Desafio opcional para a turma
Implemente **Backspace** (tecla e bot√£o): se houver algo em `calculo`, remova o **√∫ltimo caractere** e atualize o display. Trate o caso em que s√≥ sobra vazio e volte para `"0"`.